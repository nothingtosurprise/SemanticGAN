<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SemanticGAN</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    
    <header class="header">
      <h1>SemanticGAN</h1>
      
      <div class="intro">
        A research prototype that generates RDF triples from the 
        <a href="https://dblp.org/xml/" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">DBLP Computer Science Bibliography</a> 
        using a 
        <a href="https://fr.wikipedia.org/wiki/R%C3%A9seaux_antagonistes_g%C3%A9n%C3%A9ratifs_de_Wasserstein" target="_blank" style="color: var(--accent); text-decoration: none; border-bottom: 1px dotted;">Wasserstein GAN</a>.
      </div>
      
      <div class="last-updated" id="lastUpdated">Loading system status...</div>
    </header>

    <main id="main">
      
      <div class="section">
        <h2>Model Metrics</h2>
        <p class="note-description">
          Metrics computed from the most recent training run.
        </p>
        
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-val" id="noveltyScore">--%</div>
            <div class="metric-label">Novelty Score</div>
            <div class="metric-sub">Not present in training data</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-val" id="uniqueScore">--%</div>
            <div class="metric-label">Uniqueness Score</div>
            <div class="metric-sub">Distinct generated triples</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="overlapScore">--%</div>
            <div class="metric-label">Train Overlap</div>
            <div class="metric-sub">Exact matches with training triples</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="relDiversity">--%</div>
            <div class="metric-label">Relation Diversity</div>
            <div class="metric-sub">Used relation types vs schema</div>
          </div>

          <div class="metric-card">
            <div class="metric-val" id="avgDistance">--</div>
            <div class="metric-label">Average Distance</div>
            <div class="metric-sub">Average distance in embedding space</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-val" id="totalGen">--</div>
            <div class="metric-label">Generated RDF Candidates</div>
            <div class="metric-sub">Produced in the latest run</div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Generated RDF Candidates</h2>
        <p class="note-description">
          The following connections were generated by the Generative Adversarial Network. 
          <span class="novel-tag">NOVEL</span> indicates a connection not present in the original training data.
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th style="width: 25%">Relation</th>
                <th style="width: 50%">Generated Entity</th>
                <th style="width: 15%">Score</th>
                <th style="width: 10%">Type</th>
              </tr>
            </thead>
            <tbody id="hypothesesTable">
              <tr>
                <td colspan="4" style="text-align:center; padding: 20px;">
                  Loading model outputs...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>Training Loss</h2>
        <p class="note-description">
          Training loss values recorded over twenty epochs.
        </p>
        <div class="chart-container">
          <img
            src="data/processed/loss_curve.png"
            alt="Training loss curve"
            onerror="this.style.display='none'; this.parentElement.innerHTML='<p style=&quot;color:#999&quot;>Chart pending next training run.</p>'"
          >
        </div>
      </div>

    </main>

    <script>
      async function loadDashboard() {
        try {
          const response = await fetch('dashboard_data.json', { cache: "no-store" });
          if (!response.ok) throw new Error("Dashboard data not found");
          
          const data = await response.json();

          document.getElementById('lastUpdated').innerText =
            "System Status: ONLINE | Last Run: " + data.last_updated;

          document.getElementById('noveltyScore').innerText =
            data.stats.novelty + "%";
          document.getElementById('uniqueScore').innerText =
            data.stats.uniqueness + "%";
          if (data.stats.train_overlap !== undefined) {
            document.getElementById('overlapScore').innerText =
              data.stats.train_overlap + "%";
          }
          if (data.stats.relation_diversity !== undefined) {
            document.getElementById('relDiversity').innerText =
              data.stats.relation_diversity + "%";
          }
          if (data.stats.avg_distance !== undefined) {
            document.getElementById('avgDistance').innerText =
              data.stats.avg_distance;
          }
          document.getElementById('totalGen').innerText =
            data.stats.total_generated;

          const tbody = document.getElementById('hypothesesTable');
          tbody.innerHTML = '';

          if (data.hypotheses.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="4" style="text-align:center">No generated relations available.</td></tr>';
            return;
          }

          data.hypotheses.forEach(h => {
            const tr = document.createElement('tr');

            const badge = h.novel
              ? '<span class="novel-tag">NOVEL</span>'
              : '<span style="color: #999; font-size: 0.8em; font-weight: 500;">EXISTING</span>';

            tr.innerHTML = `
              <td style="color: var(--text-primary); font-weight: 600;">
                ${h.relation}
              </td>
              <td style="white-space: normal;">
                ${h.entity}
              </td>
              <td style="font-family: monospace;">
                ${h.score}
              </td>
              <td>
                ${badge}
              </td>
            `;
            tbody.appendChild(tr);
          });

        } catch (err) {
          console.error(err);
          document.getElementById('lastUpdated').innerText =
            "System Status: OFFLINE (Data missing)";
          document.getElementById('hypothesesTable').innerHTML =
            '<tr><td colspan="4" style="color: red; text-align: center;">Error loading dashboard data. Ensure update_dashboard.py has run.</td></tr>';
        }
      }

      document.addEventListener("DOMContentLoaded", loadDashboard);
    </script>
  </body>
</html>